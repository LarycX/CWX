{"version":3,"file":"spectrum.js","sources":["pages/index/logic/spectrum.js"],"sourcesContent":["const pickMajorStep = (bandRange) => {\n\tif (bandRange <= 0.12) {\n\t\treturn 0.01\n\t}\n\tif (bandRange <= 0.3) {\n\t\treturn 0.05\n\t}\n\treturn 0.1\n}\n\nconst buildBandSegments = (bands, pxPerMHz, gapPx) => {\n\tlet cursor = 0\n\treturn bands.map((band) => {\n\t\tconst width = (band.max - band.min) * pxPerMHz\n\t\tconst segment = {\n\t\t\t...band,\n\t\t\tstartX: cursor,\n\t\t\tendX: cursor + width,\n\t\t\twidth\n\t\t}\n\t\tcursor += width + gapPx\n\t\treturn segment\n\t})\n}\n\nconst buildTicks = (bandSegments, rulerSpacer, pxPerMHz) => {\n\tconst ticks = []\n\tlet globalIndex = 0\n\tbandSegments.forEach((band) => {\n\t\tconst majorStep = pickMajorStep(band.max - band.min)\n\t\tconst minorStep = majorStep / 5\n\t\tconst precision = majorStep < 0.01 ? 3 : 2\n\t\tconst start = band.min\n\t\tconst end = band.max + 0.000001\n\t\tlet index = 0\n\t\tfor (let freq = start; freq <= end; freq += minorStep) {\n\t\t\tconst isMajor = index % 5 === 0\n\t\t\tconst rounded = Number(freq.toFixed(5))\n\t\t\tconst x = rulerSpacer + band.startX + (rounded - band.min) * pxPerMHz\n\t\t\tticks.push({\n\t\t\t\tid: `tick-${globalIndex}`,\n\t\t\t\tx,\n\t\t\t\ttype: isMajor ? 'major' : 'minor',\n\t\t\t\tlabel: isMajor ? rounded.toFixed(precision) : ''\n\t\t\t})\n\t\t\tindex += 1\n\t\t\tglobalIndex += 1\n\t\t}\n\t})\n\treturn ticks\n}\n\nconst snapFrequency = (band, freq) => {\n\tconst step = 0.01\n\tconst snapped = Math.round((freq - band.min) / step) * step + band.min\n\treturn Math.min(band.max, Math.max(band.min, Number(snapped.toFixed(3))))\n}\n\nconst computeFrequencyFromScroll = ({\n\tscrollLeft,\n\trulerViewportWidth,\n\trulerSpacer,\n\ttotalBandWidth,\n\tbandSegments,\n\tpxPerMHz\n}) => {\n\tconst centerX = scrollLeft + rulerViewportWidth / 2\n\tconst contentX = centerX - rulerSpacer\n\tif (contentX <= 0) {\n\t\treturn snapFrequency(bandSegments[0], bandSegments[0].min)\n\t}\n\tif (contentX >= totalBandWidth) {\n\t\tconst last = bandSegments[bandSegments.length - 1]\n\t\treturn snapFrequency(last, last.max)\n\t}\n\tlet closest = bandSegments[0]\n\tlet minDistance = Infinity\n\tfor (let i = 0; i < bandSegments.length; i += 1) {\n\t\tconst band = bandSegments[i]\n\t\tif (contentX >= band.startX && contentX <= band.endX) {\n\t\t\tconst offsetMHz = (contentX - band.startX) / pxPerMHz\n\t\t\treturn snapFrequency(band, band.min + offsetMHz)\n\t\t}\n\t\tconst distance = contentX < band.startX ? band.startX - contentX : contentX - band.endX\n\t\tif (distance < minDistance) {\n\t\t\tminDistance = distance\n\t\t\tclosest = band\n\t\t}\n\t}\n\tconst edge = contentX < closest.startX ? closest.startX : closest.endX\n\tconst offsetMHz = (edge - closest.startX) / pxPerMHz\n\treturn snapFrequency(closest, closest.min + offsetMHz)\n}\n\nconst scrollLeftForFrequency = ({\n\tfreq,\n\tbandSegments,\n\trulerSpacer,\n\trulerViewportWidth,\n\tpxPerMHz\n}) => {\n\tconst band = bandSegments.find((segment) => freq >= segment.min && freq <= segment.max)\n\tconst segment = band || bandSegments[0]\n\tconst x = rulerSpacer + segment.startX + (freq - segment.min) * pxPerMHz\n\treturn Math.max(0, x - rulerViewportWidth / 2)\n}\n\nexport {\n\tbuildBandSegments,\n\tbuildTicks,\n\tcomputeFrequencyFromScroll,\n\tpickMajorStep,\n\tsnapFrequency,\n\tscrollLeftForFrequency\n}\n"],"names":["offsetMHz","segment"],"mappings":"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"}